/* eslint-disable no-bitwise */

function uuidv4() {
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {
    const r = (Math.random() * 16) | 0;
    const v = c === 'x' ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

function getCookie(key) {
  const keyValue = document.cookie.match(`(^|;) ?${key}=([^;]*)(;|$)`);
  return keyValue ? keyValue[2] : null;
}

window.generateAnonymousUserId = () => {
  window.ANONYMOUS_SEGMENT_ID =
    window.ANONYMOUS_SEGMENT_ID ||
    // always set for experiment pages (received from request's "ajs_anonymous_id" cookie or generated value fallback)
    (getCookie('ajs_anonymous_id') || '').replace(/%22/g, '') || // for non-experimental pages, get segment's ajs_anonymous_id cookie. The value is wrapped with %22 prefix / suffix, so we need to remove it
    uuidv4(); // when no segment's ajs_anonymous_id cookie available, it means it's a very first visit at hotjar.com, so generate new id
};
// This code will get executed after the person consents to cookies.
window.onConsentGivenCallback = function onConsentGivenCallback() {
  window.postMessage('onConsentGivenCallback', '*');
};
